<!--pages/checklist/checklist.wxml-->
<view class="checklist-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left">
      <button class="back-btn" size="mini" bindtap="goBack">â† è¿”å›</button>
      <view class="header-title">
        <text class="page-title">{{trip.destination}} - ç‰©å“æ¸…å•</text>
        <text class="hint-text">å‹¾é€‰çš„ä¸ºéœ€è¦æºå¸¦çš„ç‰©å“</text>
      </view>
    </view>
    <view class="header-right">
      <button class="add-btn" size="mini" type="primary" bindtap="showAddFromOverview">+ æ·»åŠ </button>
      <button class="check-btn" type="primary" size="mini" bindtap="startCheck">å¼€å§‹æŸ¥éªŒ</button>
    </view>
  </view>

  <!-- è¿›åº¦æ¦‚è§ˆ -->
  <view class="progress-card">
    <view class="progress-stats">
      <view class="stat-item">
        <text class="stat-number">{{checkedCount}}</text>
        <text class="stat-label">å·²å‹¾é€‰</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{totalCount - checkedCount}}</text>
        <text class="stat-label">æœªå‹¾é€‰</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{totalCount}}</text>
        <text class="stat-label">æ€»ç‰©å“</text>
      </view>
    </view>
    <progress 
      class="progress-bar" 
      percent="{{progressPercentage}}" 
      stroke-width="8"
      activeColor="#409eff"
    />
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <picker 
      class="filter-picker" 
      mode="selector" 
      range="{{categoryOptions}}" 
      range-key="label"
      value="{{categoryIndex}}"
      bindchange="onCategoryChange"
    >
      <view class="picker-text">
        {{selectedCategoryLabel}}
      </view>
    </picker>
    
    <input 
      class="filter-input" 
      placeholder="æœç´¢ç‰©å“åç§°" 
      value="{{filterForm.keyword}}"
      bindinput="onKeywordInput"
    />
    
    <button class="reset-btn" size="mini" bindtap="resetFilter">é‡ç½®</button>
  </view>

  <!-- ç‰©å“åˆ—è¡¨ -->
  <view class="item-list">
    <view 
      class="item-card {{item.checked ? 'checked' : ''}}" 
      wx:for="{{filteredItems}}" 
      wx:key="id"
    >
      <view class="item-header">
        <checkbox-group bindchange="updateItemStatus">
          <label class="checkbox-label">
            <checkbox value="{{item.id}}" checked="{{item.checked}}" />
            <text class="item-name">{{item.name}}</text>
          </label>
        </checkbox-group>
        <text class="item-delete" bindtap="deleteItem" data-id="{{item.id}}">åˆ é™¤</text>
      </view>
      
      <view class="item-content">
        <text class="item-category">{{item.categoryText}}</text>
        <text wx:if="{{item.description}}" class="item-description">{{item.description}}</text>
        <text wx:if="{{item.note}}" class="item-note">ğŸ“ {{item.note}}</text>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{filteredItems.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— ç‰©å“æ•°æ®</text>
      <button class="empty-btn" type="primary" bindtap="showAddFromOverview">æ·»åŠ ç‰©å“</button>
    </view>
  </view>

  <!-- æ·»åŠ ç‰©å“å¯¹è¯æ¡† -->
  <view wx:if="{{showAddItemDialog}}" class="dialog-mask" bindtap="cancelAddItem">
    <view class="dialog-content" catchtap="stopPropagation">
      <view class="dialog-header">
        <text class="dialog-title">æ·»åŠ æ–°ç‰©å“</text>
        <text class="dialog-close" bindtap="cancelAddItem">Ã—</text>
      </view>
      
      <view class="dialog-body">
        <view class="form-item">
          <text class="form-label">ç‰©å“åç§° *</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ç‰©å“åç§°"
            value="{{addItemForm.name}}"
            bindinput="onItemNameInput"
          />
        </view>

        <view class="form-item">
          <text class="form-label">åˆ†ç±» *</text>
          <picker 
            mode="selector" 
            range="{{categoryOptionsWithoutAll}}" 
            range-key="label"
            value="{{addItemForm.categoryIndex}}"
            bindchange="onItemCategoryChange"
          >
            <view class="picker-view">
              {{selectedCategoryLabelForAdd}}
            </view>
          </picker>
        </view>

        <view class="form-item">
          <text class="form-label">æè¿°</text>
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥ç‰©å“æè¿°ï¼ˆå¯é€‰ï¼‰"
            value="{{addItemForm.description}}"
            bindinput="onItemDescriptionInput"
            maxlength="200"
          />
        </view>

        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
            value="{{addItemForm.note}}"
            bindinput="onItemNoteInput"
            maxlength="200"
          />
        </view>
      </view>

      <view class="dialog-footer">
        <button class="dialog-btn" bindtap="cancelAddItem">å–æ¶ˆ</button>
        <button class="dialog-btn primary" bindtap="confirmAddItem">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- ä»ç‰©å“æ€»è§ˆé€‰æ‹©å¯¹è¯æ¡† -->
  <view wx:if="{{showItemOverviewDialog}}" class="dialog-mask" bindtap="closeItemOverviewDialog">
    <view class="dialog-content large" catchtap="stopPropagation">
      <view class="dialog-header">
        <text class="dialog-title">ä»ç‰©å“åº“é€‰æ‹©</text>
        <text class="dialog-close" bindtap="closeItemOverviewDialog">Ã—</text>
      </view>
      
      <view class="dialog-body">
        <view class="overview-list">
          <view 
            class="overview-item" 
            wx:for="{{itemOverviewFiltered}}" 
            wx:key="id"
            bindtap="selectFromOverview"
            data-id="{{item.id}}"
          >
            <text class="overview-name">{{item.name}}</text>
            <text class="overview-category">{{getCategoryText(item.category)}}</text>
          </view>
          <view wx:if="{{itemOverviewFiltered.length === 0}}" class="empty-overview">
            <text>æ‰€æœ‰ç‰©å“å·²æ·»åŠ </text>
          </view>
        </view>
      </view>

      <view class="dialog-footer">
        <button class="dialog-btn primary" bindtap="showAddItem">æ·»åŠ è‡ªå®šä¹‰ç‰©å“</button>
        <button class="dialog-btn" bindtap="closeItemOverviewDialog">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
