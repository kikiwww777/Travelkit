<!--pages/check-process/check-process.wxml-->
<view class="check-process-container">
  <!-- è¡Œç¨‹å¤´éƒ¨ä¿¡æ¯ -->
  <view class="trip-header">
    <view class="trip-info">
      <text class="trip-destination">{{trip.destination}}</text>
      <view class="trip-meta">
        <text class="trip-dates">ğŸ“… {{trip.startDate}} - {{trip.endDate}}</text>
        <text class="trip-duration">â± {{trip.duration}}å¤©</text>
      </view>
    </view>
    <view class="trip-actions">
      <button class="action-btn" size="mini" bindtap="pauseCheckMode" wx:if="{{isCheckingMode}}">æš‚åœæŸ¥éªŒ</button>
      <button class="action-btn primary" size="mini" bindtap="completeCheckMode" wx:if="{{isCheckingMode}}">å®ŒæˆæŸ¥éªŒ</button>
      <button class="action-btn" size="mini" bindtap="exitCheckMode">é€€å‡º</button>
    </view>
  </view>

  <!-- æŸ¥éªŒè¿›åº¦ -->
  <view class="progress-card">
    <view class="progress-stats">
      <view class="stat-item">
        <text class="stat-number">{{checkedCount}}</text>
        <text class="stat-label">å·²æŸ¥éªŒ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{skippedCount}}</text>
        <text class="stat-label">å·²è·³è¿‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{pendingCount}}</text>
        <text class="stat-label">å¾…æŸ¥éªŒ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{totalItemsCount}}</text>
        <text class="stat-label">æ€»ç‰©å“</text>
      </view>
    </view>
    <progress 
      class="progress-bar" 
      percent="{{progressPercentage}}" 
      stroke-width="10"
      activeColor="#409eff"
    />
  </view>

  <!-- æŸ¥éªŒæ¨¡å¼é€‰æ‹© -->
  <view class="check-mode-selector">
    <view class="mode-tabs">
      <view 
        class="mode-tab {{currentCheckMode === 'manual' ? 'active' : ''}}"
        bindtap="switchCheckMode"
        data-mode="manual"
      >
        <text class="mode-icon">âœ“</text>
        <text class="mode-text">é€é¡¹å‹¾é€‰</text>
      </view>
      <view 
        class="mode-tab {{currentCheckMode === 'photo' ? 'active' : ''}}"
        bindtap="switchCheckMode"
        data-mode="photo"
      >
        <text class="mode-icon">ğŸ“·</text>
        <text class="mode-text">æ‹ç…§éªŒè¯</text>
      </view>
      <view 
        class="mode-tab {{currentCheckMode === 'voice' ? 'active' : ''}}"
        bindtap="switchCheckMode"
        data-mode="voice"
      >
        <text class="mode-icon">ğŸ¤</text>
        <text class="mode-text">è¯­éŸ³ç¡®è®¤</text>
      </view>
    </view>
  </view>

  <!-- å·²æŸ¥éªŒç‰©å“åˆ—è¡¨ -->
  <view wx:if="{{checkedItemsList.length > 0 || skippedItemsList.length > 0}}" class="checked-items-box">
    <view class="checked-items-header">
      <text class="checked-title">å·²æŸ¥éªŒç‰©å“ ({{checkedItemsList.length + skippedItemsList.length}})</text>
    </view>
    <view class="checked-items-list">
      <view 
        class="checked-item-tag success"
        wx:for="{{checkedItemsList}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="removeCheckRecord"
      >
        <text class="item-icon">âœ“</text>
        <text class="item-name">{{item.name}}</text>
      </view>
      <view 
        class="checked-item-tag danger"
        wx:for="{{skippedItemsList}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="removeCheckRecord"
      >
        <text class="item-icon">âœ—</text>
        <text class="item-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- å½“å‰æŸ¥éªŒç‰©å“ -->
  <view wx:if="{{currentCheckItem}}" class="current-check-item">
    <view class="item-header">
      <text class="item-title">{{currentCheckItem.name}}</text>
      <text class="item-category">{{getCategoryText(currentCheckItem.category)}}</text>
    </view>
    
    <view class="item-info" wx:if="{{currentCheckItem.note}}">
      <text class="info-icon">ğŸ“</text>
      <text class="info-text">{{currentCheckItem.note}}</text>
    </view>
    
    <!-- é€é¡¹å‹¾é€‰æ¨¡å¼ -->
    <view wx:if="{{currentCheckMode === 'manual'}}" class="manual-check">
      <checkbox-group bindchange="handleCheckboxChange" key="{{checkboxKey}}">
        <label class="checkbox-large">
          <checkbox value="checked" checked="{{checkboxChecked}}" />
          <text class="checkbox-text">æˆ‘å·²ç¡®è®¤æºå¸¦æ­¤ç‰©å“</text>
        </label>
      </checkbox-group>
    </view>
    
    <!-- æ‹ç…§éªŒè¯æ¨¡å¼ -->
    <view wx:if="{{currentCheckMode === 'photo'}}" class="photo-check">
      <view wx:if="{{!uploadedPhoto}}" class="photo-upload">
        <button class="photo-btn" type="primary" bindtap="choosePhoto">
          <text class="btn-icon">ğŸ“·</text>
          <text class="btn-text">é€‰æ‹©ç…§ç‰‡</text>
        </button>
      </view>
      <view wx:if="{{uploadedPhoto}}" class="photo-preview">
        <image class="preview-image" src="{{uploadedPhoto}}" mode="aspectFit" />
        <view class="photo-actions">
          <button class="photo-action-btn" type="primary" bindtap="confirmPhotoCheck">ç¡®è®¤ç…§ç‰‡</button>
          <button class="photo-action-btn" bindtap="retakePhoto">é‡æ–°æ‹ç…§</button>
        </view>
      </view>
    </view>
    
    <!-- è¯­éŸ³ç¡®è®¤æ¨¡å¼ -->
    <view wx:if="{{currentCheckMode === 'voice'}}" class="voice-check">
      <view wx:if="{{!voiceResult}}" class="voice-recorder">
        <button 
          class="voice-btn {{isRecording ? 'recording' : ''}}" 
          type="primary"
          bindtap="toggleRecording"
        >
          <text class="btn-icon">{{isRecording ? 'â¸' : 'ğŸ¤'}}</text>
          <text class="btn-text">{{isRecording ? 'åœæ­¢å½•éŸ³' : 'å¼€å§‹å½•éŸ³'}}</text>
        </button>
        <text class="voice-tip">è¯·è¯´å‡ºï¼š"æˆ‘å·²æºå¸¦{{currentCheckItem.name}}"</text>
      </view>
      <view wx:if="{{voiceResult}}" class="voice-result">
        <text class="result-text">{{voiceResult}}</text>
        <view class="voice-actions">
          <button class="voice-action-btn" type="primary" bindtap="confirmVoiceCheck">ç¡®è®¤è¯­éŸ³</button>
          <button class="voice-action-btn" bindtap="retryVoice">é‡æ–°å½•éŸ³</button>
        </view>
      </view>
    </view>
    
    <view class="item-actions">
      <button class="skip-btn" bindtap="skipCurrentItem">è·³è¿‡æ­¤é¡¹</button>
    </view>
  </view>
  
  <!-- æŸ¥éªŒå®Œæˆ -->
  <view wx:if="{{!currentCheckItem && totalItemsCount > 0}}" class="check-complete">
    <text class="complete-icon">âœ“</text>
    <text class="complete-title">æ‰€æœ‰ç‰©å“å·²æŸ¥éªŒå®Œæˆï¼</text>
    <text class="complete-progress">æŸ¥éªŒè¿›åº¦ï¼š{{checkedCount}}/{{totalItemsCount}}</text>
    <button class="complete-btn" type="primary" bindtap="completeCheckMode">å®ŒæˆæŸ¥éªŒ</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{totalItemsCount === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“¦</text>
    <text class="empty-text">æš‚æ— ç‰©å“éœ€è¦æŸ¥éªŒ</text>
    <button class="empty-btn" bindtap="exitCheckMode">è¿”å›</button>
  </view>
</view>

