<!--pages/trip-detail/trip-detail.wxml-->
<view class="trip-detail-container">
  <view wx:if="{{loading}}" class="loading-state">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:else class="trip-detail">
    <!-- è¡Œç¨‹å¤´éƒ¨ä¿¡æ¯ -->
    <view class="trip-header">
      <view class="trip-info">
        <text class="trip-destination">{{trip.destination}}</text>
        <view class="trip-meta">
          <text class="trip-status status-{{trip.status}}">{{getStatusText(trip.status)}}</text>
          <text class="trip-dates">ğŸ“… {{trip.startDate}} - {{trip.endDate}}</text>
          <text class="trip-duration">â± {{trip.duration}}å¤©</text>
          <text class="trip-travelers">ğŸ‘¥ {{trip.travelers}}äºº</text>
          <text class="trip-type">ğŸ“ {{getTypeText(trip.type)}}</text>
        </view>
      </view>
    </view>

    <!-- æŸ¥éªŒè¿›åº¦ -->
    <view wx:if="{{totalItemsCount > 0}}" class="progress-card">
      <view class="progress-header">
        <text class="progress-title">æŸ¥éªŒè¿›åº¦</text>
        <text class="progress-text">{{checkedCount}}/{{totalItemsCount}}</text>
      </view>
      <progress 
        class="progress-bar" 
        percent="{{progressPercentage}}" 
        stroke-width="8"
        activeColor="#409eff"
      />
    </view>

    <!-- è¡Œç¨‹ä¿¡æ¯å¡ç‰‡ -->
    <view class="trip-info-card">
      <view class="card-header">
        <text class="card-title">è¡Œç¨‹ä¿¡æ¯</text>
      </view>
      <view class="card-body">
        <view wx:if="{{trip.description}}" class="info-row">
          <text class="info-label">ğŸ“ è¡Œç¨‹æè¿°</text>
          <text class="info-value">{{trip.description}}</text>
        </view>
        <view wx:if="{{trip.specialNeeds}}" class="info-row">
          <text class="info-label">âš ï¸ ç‰¹æ®Šéœ€æ±‚</text>
          <text class="info-value">{{trip.specialNeeds}}</text>
        </view>
      </view>
    </view>

    <!-- å¤©æ°”é¢„æŠ¥å¡ç‰‡ -->
    <view wx:if="{{weatherForecast30d || loadingWeather}}" class="weather-card">
      <view class="card-header">
        <text class="card-title">â˜ï¸ ç›®çš„åœ°å¤©æ°”</text>
        <text class="weather-hint">(ä»…èƒ½å±•ç¤º30å¤©å†…å¤©æ°”)</text>
      </view>
      <view class="card-body">
        <!-- åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{loadingWeather}}" class="weather-loading">
          <text>åŠ è½½å¤©æ°”ä¿¡æ¯ä¸­...</text>
        </view>

        <!-- å¤©æ°”ä¿¡æ¯ -->
        <view wx:elif="{{weatherForecast30d && weatherForecast30d.forecast && weatherForecast30d.forecast.length > 0}}" class="weather-content">
          <view class="weather-city">{{weatherForecast30d.city}}</view>
          <view wx:if="{{weatherForecast30d.hasError}}" class="weather-error-tip">
            <text>âš ï¸ {{weatherForecast30d.errorMessage}}</text>
          </view>
          <scroll-view class="weather-forecast" scroll-x="true">
            <view class="forecast-list">
              <view 
                class="forecast-item {{item.isInTripRange ? 'is-trip-date' : ''}}"
                wx:for="{{weatherForecast30d.forecast}}" 
                wx:key="date"
              >
                <text class="forecast-date">{{item.formattedDate}}</text>
                <view class="forecast-info">
                  <view class="forecast-icons">
                    <image wx:if="{{item.iconDay}}" class="forecast-icon" src="{{item.iconDay}}" mode="aspectFit" />
                    <image wx:if="{{item.iconNight}}" class="forecast-icon forecast-icon-night" src="{{item.iconNight}}" mode="aspectFit" />
                  </view>
                  <view class="forecast-temp">
                    <text class="temp-max">{{item.tempMax}}Â°</text>
                    <text class="temp-min">/ {{item.tempMin}}Â°</text>
                  </view>
                  <view class="forecast-text">
                    <text class="forecast-text-day">{{item.textDay}}</text>
                    <text wx:if="{{item.textNight && item.textNight !== item.textDay}}" class="forecast-text-night">{{item.textNight}}</text>
                  </view>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <view wx:elif="{{weatherError}}" class="weather-error">
          <text>âš ï¸ {{weatherError}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="action-btn primary" 
        type="primary" 
        bindtap="viewChecklist"
      >
        ğŸ“‹ æŸ¥çœ‹ç‰©å“æ¸…å•
      </button>
      <button 
        class="action-btn" 
        bindtap="startCheck"
        disabled="{{trip.status === 'completed' || trip.status === 'cancelled'}}"
      >
        âœ“ å¼€å§‹æŸ¥éªŒ
      </button>
    </view>
  </view>
</view>
